\documentclass[12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage{enumitem}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage[normalem]{ulem}

\newcommand{\mname}[1]{\mbox{\sf #1}}
\newcommand{\pnote}[1]{{\langle \text{#1} \rangle}}


\title{Assignment 6: Decomposition and Normal Forms}
\author{Hien Tu - tun1}
\date{\today}

\begin{document}

\maketitle

\textbf{Part 1: The analysis of a quick-event wizard for a local community}
\begin{enumerate}
  % Question 1
  \item Minimal cover of all realistic non-trivial functional dependencies:
        \begin{itemize}
          \item Since each event is organized by a user, we know that if the
                event id (\emph{id}) is the same, then the organizer
                (\emph{user\_id}) must be the same. So, we can have id
                $\longrightarrow$ user\_id. The reverse would not hold since an
                organizer could organize many events.
          \item Furthermore, each event happens in a day, so, we know that if
                the event id (\emph{id}) is the same, the date that the event
                happens in (\emph{date}) must be the same. So, we can have id
                $\longrightarrow$ date.
          \item We also have id, inv\_id $\longrightarrow$ inv\_confirmed since
                each guest would determine what event to go to. We need both the
                event id (\emph{id}) and the guest (\emph{inv\_id}) to determine
                if the invitation is confirmed (\emph{inv\_confirmed}).
          \item Furthermore, we have id, product $\longrightarrow$ p\_amount
                since we would only know how much to bring if we know what to
                bring and where we need to bring it to. Only the product
                wouldn't be able to determine the amount since different event
                could need different amount of the same product. For example, in
                the given table, event 1 needs 4 chips while event 2 only needs
                2 chips.
          \item We have product $\longrightarrow$ p\_price since each product
                has its own price. The price of the product wouldn't depend on
                the event that the product is brough into. An example is that,
                in the given table, the chips cost \$2 no matter if it is
                brought into event with id 1 or 2 and the cola would cost \$4 no
                matter if it is brought into event with id 1 or 2.
        \end{itemize}

  % Question 2
  \item An example of a non-trivial dependency is id $\twoheadrightarrow$
        inv\_id, inv\_confirmed. This would hold since, for example, in the
        given table, from the first row and the fourth row, we know that there
        would exist a row where inv\_id and inv\_confirmed are the same as the
        first row and the rest of the attributes (user\_id, date, product,
        p\_price, p\_amount) are the same as the fourth row. This row is the
        thrid row. We also know that there would exist a row where inv\_id and
        inv\_confirmed are the same as the fourth row and the rest of the
        attributes (user\_id, date, product, p\_price, p\_amount) are the same
        as the first row. This row is the second row.
\end{enumerate}
\ \\


\textbf{Part 2: Refinement of an order-table for a cinema chain}

We will use the short hand notation for each attribute for brevity.
\begin{enumerate}
  \setcounter{enumi}{2}
  \item The relational schema is not in 3NF since I $\longrightarrow$ St, Si,
        Ss, Sd would violate the 3NF property since \{St, Si, Ss, Sd\} $\not
        \subseteq$ I, I is not a (super)key and each attribute in \{St, Si, Ss,
        Sd\} $\setminus$ I = \{St, Si, Ss, Sd\} is not part of a key. \\

        To decompose, first, we need to compute the minimal cover of the
        functional dependencies
        \begin{itemize}
          \item We can use Decomposition on the first three functional
                dependencies to get \\
                \{I $\longrightarrow$ St; I $\longrightarrow$ Si; I
                $\longrightarrow$ Ss; I $\longrightarrow$ Sd; I
                $\longrightarrow$ Fi; I $\longrightarrow$ Fl; I
                $\longrightarrow$ Fs; I $\longrightarrow$ Ri; I
                $\longrightarrow$ Rs; Si $\longrightarrow$ Si; Si
                $\longrightarrow$ Ss; Si $\longrightarrow$ Sd; Ss
                $\longrightarrow$ Sd; Sd $\longrightarrow$ Ss; St, Ri
                $\longrightarrow$ Fi; Fi $\longrightarrow$ Fl; Fi, Si
                $\longrightarrow$ Fs; Ri $\longrightarrow$ Rs\}
          \item From Reflexivity, since Si $\subseteq$ Si, we can get Si
                $\longrightarrow$ Si. So, we don't need to include Si
                $\longrightarrow$ Si in the minimal cover. \\
                By Transitivity on I $\longrightarrow$ Si and Si
                $\longrightarrow$ Ss, we can get I $\longrightarrow$ Ss. So, we
                don't need I $\longrightarrow$ Ss. \\
                By Transitivity on I $\longrightarrow$ Si and Si
                $\longrightarrow$ Sd, we can get I $\longrightarrow$ Sd. So, we
                don't need I $\longrightarrow$ Sd. \\
                By Union on I $\longrightarrow$ St and I $\longrightarrow$ Ri;
                we can get I $\longrightarrow$ St, Ri. By Transitivity on I
                $\longrightarrow$ St, Ri and St, Ri $\longrightarrow$ Fi; we can
                get I $\longrightarrow$ Fi. So we don't need I $\longrightarrow$
                Fi. \\
                By Transitivity on I $\longrightarrow$ Fi (that we just proved)
                and Fi $\longrightarrow$ Fl, we can get I $\longrightarrow$ Fl.
                So, we don't need I $\longrightarrow$ Fl. \\
                By Union on I $\longrightarrow$ Fi and I $\longrightarrow$ Si;
                we can get I $\longrightarrow$ Fi, Si. By Transitivity on I
                $\longrightarrow$ Fi, Si and Fi, Si $\longrightarrow$ Fs, we can
                get I $\longrightarrow$ Fs. So, we don't need I
                $\longrightarrow$ Fs. \\
                By Transitivity on Si $\longrightarrow$ Ss and Ss
                $\longrightarrow$ Sd, we can get Si $\longrightarrow$ Sd. So, we
                don't need Si $\longrightarrow$ Sd. \\
                Thus, we would get \\
                \{I $\longrightarrow$ St; I $\longrightarrow$ Si; I
                $\longrightarrow$ Ri; Si $\longrightarrow$ Ss; Ss
                $\longrightarrow$ Sd; Sd $\longrightarrow$ Ss; St, Ri
                $\longrightarrow$ Fi; Fi $\longrightarrow$ Fl; Fi, Si
                $\longrightarrow$ Fs; Ri $\longrightarrow$ Rs\}
          \item Notice that the set above is already minimal. So it is the
                minimal cover.
        \end{itemize}
        Starting the algorithm, we get know 
        \begin{itemize}
          \item $result = \{\}$
          \item $cover = $
                \{I $\longrightarrow$ St; I $\longrightarrow$ Si; I
                $\longrightarrow$ Ri; Si $\longrightarrow$ Ss; Ss
                $\longrightarrow$ Sd; Sd $\longrightarrow$ Ss; St, Ri
                $\longrightarrow$ Fi; Fi $\longrightarrow$ Fl; Fi, Si
                $\longrightarrow$ Fs; Ri $\longrightarrow$ Rs\}
        \end{itemize}
        First, we have I $\longrightarrow$ St
        \begin{itemize}
          \item Since we have I $\longrightarrow$ St, I $\longrightarrow$ Si, I
                $\longrightarrow$ Ri $\in cover$, we get $B = \{St, Si, Ri\}$
          \item So, $result =$ \{(I, St, Si, Ri)\}
        \end{itemize}
        Next, we have Si $\longrightarrow$ Ss
        \begin{itemize}
          \item Since only Si $\longrightarrow$ Ss $\in cover$ that starts with
                Si, $B = \{Ss\}$
          \item So, $result =$ \{(I, St, Si, Ri), (Si, Ss)\}
        \end{itemize}
        Then, we have Ss $\longrightarrow$ Sd
        \begin{itemize}
          \item Since only Ss $\longrightarrow$ Sd $\in cover$ that starts with
                Ss, $B = \{Sd\}$
          \item So, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss, Sd)\}
        \end{itemize}
        Then, we have Sd $\longrightarrow$ Ss
        \begin{itemize}
          \item Since only Sd $\longrightarrow$ Ss $\in cover$ that starts with
                Sd, $B = \{Ss\}$
          \item So, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss, Sd), (Sd, Ss)\}
        \end{itemize}
        Next, we have St, Ri $\longrightarrow$ Fi
        \begin{itemize}
          \item Since only St, Ri $\longrightarrow$ Fi $\in cover$ that starts
                with St, Ri; $B = \{Fi\}$
          \item So, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss, Sd), (Sd, Ss),
                (St, Ri, Fi)\}
        \end{itemize}
        Next, we have Fi $\longrightarrow$ Fl
        \begin{itemize}
          \item Since only Fi $\longrightarrow$ Fl $\in cover$ that starts with
                Fi, $B = \{Fl\}$
          \item So, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss, Sd), (Sd, Ss),
                (St, Ri, Fi), (Fi, Fl)\}
        \end{itemize}
        Next, we have Fi, Si $\longrightarrow$ Fs
        \begin{itemize}
          \item Since only Fi, Si $\longrightarrow$ Fs $\in cover$ that starts
                with Fi, Si; $B = \{Fs\}$
          \item So, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss, Sd), (Sd, Ss),
                (St, Ri, Fi), (Fi, Fl), (Fi, Si, Fs)\}
        \end{itemize}
        Finally, we have Ri $\longrightarrow$ Rs
        \begin{itemize}
          \item Since only Ri $\longrightarrow$ Rs $\in cover$ that starts
                with Ri, $B = \{Fi\}$
          \item So, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss, Sd), (Sd, Ss),
                (St, Ri, Fi), (Fi, Fl), (Fi, Si, Fs), (Ri, Rs)\}
        \end{itemize}
        Since $result$ doesn't contain the key, which is ``I, P, Rp'', we need
        to add it to $result$. So, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss,
        Sd), (Sd, Ss), (St, Ri, Fi), (Fi, Fl), (Fi, Si, Fs), (Ri, Rs), (I, P,
        Rp)\} \\
        Since (Sd, Ss) $\subseteq$ (Ss, Sd), we will remove (Sd, Ss) from
        $result$. Thus, $result =$ \{(I, St, Si, Ri), (Si, Ss), (Ss, Sd), (St,
        Ri, Fi), (Fi, Fl), (Fi, Si, Fs), (Ri, Rs), (I, P, Rp)\} \\

        Minimal cover for each relational schema of the resulting decomposition
        \begin{itemize}
          \item (I, St, Si, Ri) \\
                $\implies$ \{I $\longrightarrow$ St; I $\longrightarrow$ Si, I
                $\longrightarrow$ Ri\}
          \item (Si, Ss) \\
                $\implies$ \{Si $\longrightarrow$ Ss\}
          \item (Ss, Sd) \\
                $\implies$ \{Ss $\longrightarrow$ Sd\}
          \item (St, Ri, Fi) \\
                $\implies$ \{St, Ri $\longrightarrow$ Fi\}
          \item (Fi, Fl) \\
                $\implies$ \{Fi $\longrightarrow$ Fl\}
          \item (Fi, Si, Fs) \\
                $\implies$ \{Fi, Si $\longrightarrow$ Fs\}
          \item (Ri, Rs) \\
                $\implies$ \{Ri $\longrightarrow$ Rs\}
        \end{itemize}

        From the minimal covers of the relational schemas of the resulting
        decomposition, we can see that the decomposition is
        dependency-preserving. It is also proved in the lecture that
        Decompose-3NF is dependency-preserving.

        Furthermore, it is proved in the lecture that Decompose-3NF is also
        lossless-join. Thus, this decomposition should be lossless-join as well.
  \ \\

  % Question 4
  \item The relational schema is not in BCNF since I $\longrightarrow$ St, Si,
        Ss, Sd $\in \mathfrak{S}^+$ but I is not a (super)key. \\

        \textsc{Decompose-BCNF}:

        Since I $\longrightarrow$ St, Si, Ss, Sd $\in \mathfrak{S}^+$ violates
        the BCNF constraint since I is not the (super)key, then
        \begin{itemize}
          \item $\textbf{R}_1$ = $\text{I}^+$ 
                               = \{I, St, Si, Ss, Sd, Fi, Fl, Fs, Ri, Rs\}
          \item $\textbf{R}_2$ = I $\cup$ Z
                               = \{I, P, Rp\}
          \item Note that \{I, P, Rp\} satisfies the BCNF constraint, so they
                would be part of the resulting decomposition.
        \end{itemize}

        For $\textbf{R}_1$, since Si $\longrightarrow$ Si, Ss, Sd $\in
        \mathfrak{S}_1^+$ violates the BCNF constraint since Si is not the
        (super)key, then
        \begin{itemize}
          \item $\textbf{R}_{1, 1}$ = $\text{(Si)}^+$
                                    = \{Si, Ss, Sd\}
          \item $\textbf{R}_{1, 2}$ = Si $\cup$ Z
                                    = \{Si, I, St, Fi, Fl, Fs, Ri, Rs\}
        \end{itemize}

        For $\textbf{R}_{1,1}$, since Ss $\longrightarrow$ Sd $\in
        \mathfrak{S}_{1,1}^+$ violates the BCNF constraint, then
        \begin{itemize}
          \item $\textbf{R}_{1,1,1}$ = $\text{(Ss)}^+$
                                     = \{Ss, Sd\}
          \item $\textbf{R}_{1,1,2}$ = Ss $\cup$ Z
                                     = \{Ss, Si\}
          \item Note that \{Ss, Sd\} and \{Ss, Si\} satisfies BCNF, so they
                would be part of the resulting decomposition.
        \end{itemize}

        For $\textbf{R}_{1,2}$, since St, Ri $\longrightarrow$ Fi $\in
        \mathfrak{S}_{1,2}^+$ violates the BCNF constraint, then
        \begin{itemize}
          \item $\textbf{R}_{1,2,1}$ = $\text{\{St, Ri\}}^+$
                                     = \{St, Ri, Fi, Fl, Rs\}
          \item $\textbf{R}_{1,2,2}$ = \{St, Ri\} $\cup$ Z
                                     = \{St, Ri, I, Fs, Si\}
          \item Note that \{St, Ri, I, Fs, Si\} satisfies BCNF, so they would be
                part of the resulting decomposition.
        \end{itemize}

        For $\textbf{R}_{1,2,1}$, since Fi $\longrightarrow$ Fl $\in
        \mathfrak{S}_{1,2,1}^+$ violates the BCNF constraint, then
        \begin{itemize}
          \item $\textbf{R}_{1,2,1,1}$ = $\text{(Fi)}^+$
                                       = \{Fi, Fl\}
          \item $\textbf{R}_{1,2,1,2}$ = Fi $\cup$ Z
                                       = \{Fi, St, Ri, Rs\}
          \item Note that \{Fi, Fl\} satisfies the BCNF constraint, so they
                would be part of the resulting decomposition.
        \end{itemize}

        For $\textbf{R}_{1,2,1,2}$, since Ri $\longrightarrow$ Rs $\in
        \mathfrak{S}_{1,2,1,2}^+$ violates the BCNF constraint, then
        \begin{itemize}
          \item $\textbf{R}_{1,2,1,2,1}$ = $\text{(Ri)}^+$
                                         = \{Ri, Rs\}
          \item $\textbf{R}_{1,2,1,2,2}$ = Ri $\cup$ Z
                                         = \{Ri, Fi, St\}
          \item Noe that \{Ri, Rs\} and \{Ri, Fi, St\} satisfies the BCNF
                constraint, so they would be part of the resulting
                decomposition.
        \end{itemize}



\end{enumerate}


\end{document}